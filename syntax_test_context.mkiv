% SYNTAX TEST "Packages/ConTeXtTools/ConTeXt.sublime-syntax"

% <- text.tex.context

  \starttext
% ^^^^^^^^^^ support.function.general.context
% ^          punctuation.definition.backslash.context

% LUA
\startluacode
  context(
    5 % 2
  %   ^^^ - comment.line.percentage.context
  )
  -- context("b")
  % <- comment.line.double-dash.lua
  context("a")
  % <- source.lua.major.embedded.context - comment.line.percentage.context
\stopluacode

\startlua
  context(
    5 % 2
  %   ^^^ comment.line.percentage.context
  )
  -- context("b")
  % <- comment.line.double-dash.lua
  context("a")
  % <- source.lua.minor.embedded.context comment.line.double-dash.lua
\stoplua

\ctxlua{
  context(
    5 % 2
  %   ^^^ comment.line.percentage.context
  )
  -- context("b")
  % <- comment.line.double-dash.lua
  context("a")
  % <- source.lua.minor.embedded.context
}

% METAPOST/METAFUN
\startuniqueMPgraphic{foo}{x, y}
%                     ^^^        meta.braces.context
%                          ^^^^  meta.braces.context
%                    ^^^^^^^^^^^ - source.metapost.metafun.embedded.context
  draw (unitcircle shifted p) scaled 1cm withcolor red;
  % <- source.metapost.metafun.embedded.context
\stopuniqueMPgraphic

% MATH
Adding $1$, \m{2} and \math[three]{3} gives \mathematics{6}.
%      ^                                                   punctuation.section.dollar.begin.context
%       ^                                                  meta.environment.math.inline.context
%        ^                                                 punctuation.section.dollar.end.context
%              ^                                           meta.environment.math.inline.context
%                                  ^                       meta.environment.math.inline.context
%                                                        ^ meta.environment.math.inline.context

\startformula e^{iÏ€} = -1 \stopformula
%             ^^^^^^^^^^^ meta.environment.math.block.context

% VERBATIM
The percent sign \type[option=tex]{%} and the hash \type<<#1>> are special.
%                      ^^^^^^                                  variable.parameter.context
%                            ^                                 keyword.operator.assignment.context
%                             ^^^                              meta.other.value.context
%                     ^                                        punctuation.section.brackets.begin.context
%                     ^^^^^^^^^^^^                             meta.brackets.context
%                                ^                             punctuation.section.brackets.end.context
%                                 ^                            punctuation.section.braces.begin.context
%                                  ^                           markup.raw.inline.context - comment.line.percentage.context
%                                   ^                          punctuation.section.braces.end.context
%                                 ^^^                          meta.braces.context
%                                                       ^^     punctuation.section.angles.begin.context
%                                                         ^^   markup.raw.inline.context - variable.parameter.context
%                                                           ^^ punctuation.section.angles.end.context
%                                                       ^^^^^^ meta.angles.context

\starttyping
  [option=xml]
%  ^^^^^^     variable.parameter.context
%        ^    keyword.operator.assignment.context
%  ^^^^^^^^^^ meta.brackets.context
  <cd:command name="MPcolor" file="colo-ini.mkiv">
    <cd:arguments>
      <cd:resolve name="argument-color"/>
    </cd:arguments>
  </cd:command>
  % <- markup.raw.block.context - comment.line.percentage.context
\stoptyping

% COMMENTS

  % Lorem ipsum
% ^^^^^^^^^^^^^ comment.line.percentage.context
% ^             punctuation.definition.comment.context

% TEMPLATES a.k.a. LMX
\bTABLE
  <?lua for row=1,5 do ?>
% ^^                      punctuation.definition.tag.begin.context
%   ^^^                   entity.name.tag.lua.context
%       ^^^^^^^^^^^^^^    source.lua.embedded.context
%                      ^^ punctuation.definition.tag.end.context
% ^^^^^^^^^^^^^^^^^^^^^^^ meta.preprocessor.lua.context meta.tag.lua.context
    \bTR
      <?lua for col=1,5 do ?>
        \bTD
          cell (<?lua inject(row) ?>, <?lua inject(col) ?>)
        \eTD
      <?lua end ?>
    \eTR
  <?lua end ?>
\eTABLE

% DEFINITIONS
  \def \foo #1{!! #1 !!}
% ^^^^                   storage.type.function.general.context
%      ^^^^              entity.name.function.general.context
%           ^            punctuation.definition.variable.context
%           ^^           variable.parameter.context
%                 ^      punctuation.definition.variable.context
%                 ^^     variable.parameter.context
%              ^^^^^^^^  meta.braces.context

  \define [1] \foo {!! #1 !!}
% ^^^^^^^                     storage.type.function.general.context
%             ^^^^            entity.name.function.general.context
%                      ^      punctuation.definition.variable.context
%                      ^^     variable.parameter.context
%                    ^^^^^^^^ meta.braces.context

  \starttexdefinition nospaces unexpanded foo #1
% ^^^^^^^^^^^^^^^^^^^                            storage.type.function.general.context
%                     ^^^^^^^^                   storage.modifier.context
%                              ^^^^^^^^^^        storage.modifier.context
%                                         ^^^    entity.name.function.general.context
%                                             ^  punctuation.definition.variable.context
%                                             ^^ variable.parameter.context
    !! #1 !!
%      ^                                         punctuation.definition.variable.context
%      ^^                                        variable.parameter.context
  \stoptexdefinition

% mkvi style definitions
  \def \foo #a[#{b}]{!! #a !! #{b} !!}
% ^^^^                                 storage.type.function.general.context
%      ^^^^                            entity.name.function.general.context
%           ^                          punctuation.definition.variable.context
%           ^^                         variable.parameter.context
%              ^                       punctuation.definition.variable.context
%              ^^^                     variable.parameter.context
%                       ^              punctuation.definition.variable.context
%                       ^^             variable.parameter.context
%                             ^        punctuation.definition.variable.context
%                             ^^^      variable.parameter.context
%                   ^^^^^^^^^^^^^^^^^^ meta.braces.context

\stoptext
% <- support.function.general.context
